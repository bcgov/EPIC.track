{"forms":[{"title":"Works","display":"form","type":"form","name":"work","path":"work","tags":["common"],"components":[{"label":"onLoad","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":null,"persistent":false,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"try{\nvar headers = {\n  headers: {\n  Authorization: 'Bearer '+localStorage.getItem('authToken')\n  }\n}\nvar currentValue = value || {\n  \"dateFormat\": \"YYYY-MM-DD\",\n  \"hasValue\": (value) => {\n    if(value !== undefined && value !== \"\") return value;\n    else return false;\n  },\n  \"addEventListener\": (element,eventName, handler) =>{\n    if(element) {\n      var events = element.getAttribute('events') || [];\n      if(!events.includes(eventName)) {\n        element.addEventListener(eventName, handler);\n          events.push(eventName);\n        element.setAttribute('events',events);\n      }\n}\n  }\n};\nvar url = data.reportapiurl || localStorage.getItem('customApiUrl').split(',')[0];\nfetch(url+'staffs',headers).then(response=>response.json())\n.then(data=>{\n  currentValue = {\n    ...currentValue,\n    \"staffs\": data.staffs\n  }\n   instance.setValue(currentValue);\n});\nfetch(url+'codes/outcomes',headers).then(response=>response.json())\n.then(data=>{\n  currentValue = {\n    ...currentValue,\n    \"outcomes\": data.codes\n  }\n  instance.setValue(currentValue);\n});\n// setting the activephase to nextphase on reload\nvar activePhaseInterval = setInterval(function(){\n  if(data.actionType!=undefined) {\n    clearInterval(activePhaseInterval);\n      data.activephase = data.actionType;\n  }\n},10);\n\n}catch(e) {\n  console.error('Error from onload',e.message);\n}","calculateValue":"","calculateServer":false,"key":"onload","tags":[],"properties":{},"logic":[{"name":"submitEventLogic","trigger":{"type":"event","event":"submitEvent1"},"actions":[{"name":"submitEventAction","type":"customAction","customAction":"\ntry{\n  var overlayContent = '<div data-testid=\"overlay\" class=\"_loading_overlay_overlay css-1mm12ec _loading-overlay-transition-enter-done\"><div class=\"_loading_overlay_content css-42igfv\"></div></div>';\n  var wrapper = document.querySelector(\"[data-testid='wrapper']\");\n  var overlayElement = document.createElement('div');\n  overlayElement.innerHTML = overlayContent;\n  overlayElement = overlayElement.firstChild;\n  overlayElement.style.position = 'absolute';\n  overlayElement.style.height = '100%';\n  overlayElement.style.width = '100%';\n  overlayElement.style.top = '0px';\n  overlayElement.style.left = '0px';\n  overlayElement.style.display = 'flex';\n  overlayElement.style.fontSize = '1.2em';\n  overlayElement.style.color = 'rgb(255, 255, 255)';\n  overlayElement.style.textAlign = 'center';\n  overlayElement.style.background = 'rgba(0, 0, 0, 0.2)';\n  overlayElement.style.zIndex = '800';\n  overlayElement.style.transition = 'opacity 500ms ease-in 0s';\n  overlayElement.style.opacity = '1'\n  overlayElement.style.cursor = 'not-allowed';\n  wrapper.appendChild(overlayElement);  \n  var button = document.querySelector(\"[name='data[alternatesubmit]']\");\n  button.setAttribute('disabled','disabled');\n}catch(e) {\n  console.warn('Error from custom action, submitEventLogic',e.message);\n}\t\t"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"emlsobp"},{"label":"reportApiUrl","defaultValue":"https://eao-reports.apps.devops.aot-technologies.com/api/v1/","persistent":false,"customDefaultValue":"var urls = localStorage.getItem('customApiUrl').split(',');\nvalue = urls[0];\ninstance.setValue(urls[0]);","key":"reportapiurl","type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"ecf3s68"},{"title":"Primary","collapsible":false,"key":"primary","type":"panel","label":"Panel","input":false,"tableView":false,"components":[{"label":"Columns","columns":[{"components":[{"label":"EA Act","labelPosition":"top","widget":"choicesjs","labelWidth":"","labelMargin":"","placeholder":"","description":"","tooltip":"","customClass":"","tabindex":"","hidden":false,"hideLabel":false,"uniqueOptions":false,"autofocus":false,"disabled":false,"tableView":true,"modalEdit":false,"multiple":false,"dataSrc":"url","data":{"values":[{"label":"","value":""}],"resource":"","json":"","url":"{{data.reportapiurl}}codes/ea_acts","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"custom":""},"dataType":"","idPath":"id","valueProperty":"id","limit":100,"template":"<span>{{ item.name }}</span>","refreshOn":"","refreshOnBlur":"","clearOnRefresh":false,"searchEnabled":true,"selectThreshold":0.3,"readOnlyValue":false,"customOptions":{},"useExactSearch":false,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"clearOnHide":true,"customDefaultValue":"var element = document.querySelector(\"[name='data[works.ea_act_id]']\");\ndata.onload.addEventListener(element,'change',(event)=>{\n  instance.emit('onPhaseGridChanged',{});\n});\n\n","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":true,"onlyAvailableItems":false,"customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"unique":false,"errorLabel":"","errors":"","key":"works.ea_act_id","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"phaseGridChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"phaseGridChangeAction","type":"customAction","customAction":"console.log('SUBMISSION DATA', submission.data);\n"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"select","indexeddb":{"filter":{}},"selectValues":"codes","selectFields":"","searchField":"","searchDebounce":0.3,"minSearch":0,"filter":"","redrawOn":"","input":true,"disableLimit":false,"eaactworktypestartdate":"undefinedundefined","prefix":"","suffix":"","dataGridLabel":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"lazyLoad":true,"authenticate":false,"ignoreCache":false,"fuseOptions":{"include":"score","threshold":0.3},"id":"ewxbm9t","defaultValue":"","sort":""}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Worktype","labelPosition":"top","widget":"choicesjs","labelWidth":"","labelMargin":"","placeholder":"","description":"","tooltip":"","customClass":"","tabindex":"","hidden":false,"hideLabel":false,"uniqueOptions":false,"autofocus":false,"disabled":false,"tableView":true,"modalEdit":false,"multiple":false,"dataSrc":"url","data":{"values":[{"label":"","value":""}],"resource":"","json":"","url":"{{data.reportapiurl}}codes/work_types","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"custom":""},"dataType":"","idPath":"id","valueProperty":"id","limit":1000,"template":"<span>{{ item.name }}</span>","refreshOn":"","refreshOnBlur":"","clearOnRefresh":false,"searchEnabled":true,"selectThreshold":0.3,"readOnlyValue":false,"customOptions":{},"useExactSearch":false,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"clearOnHide":true,"customDefaultValue":"var element = document.querySelector(\"[name='data[works.work_type_id]']\");\ndata.onload.addEventListener(element,'change',(event)=>{\n  instance.emit('onPhaseGridChanged',{});\n});\n\n","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":true,"onlyAvailableItems":false,"customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"unique":false,"errorLabel":"","errors":"","key":"works.work_type_id","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"workTypeChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"workTypeChangeAction","type":"customAction","customAction":"var object = result[1];\nif(object && object.changed.component.key === 'works.work_type_id') {\n  var engagements = submission.data.engagements;\n  if(engagements && engagements.length > 0 ) {\n    _.forEach(engagements,function(engagement){\n      engagement.work_engagements.work_type_id = value;\n    });\n  \n  }\n}"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"select","indexeddb":{"filter":{}},"selectValues":"codes","selectFields":"","searchField":"","searchDebounce":0.3,"minSearch":0,"filter":"","redrawOn":"","input":true,"disableLimit":false,"eaactworktypestartdate":"undefinedundefined","prefix":"","suffix":"","dataGridLabel":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"lazyLoad":true,"authenticate":false,"ignoreCache":false,"fuseOptions":{"include":"score","threshold":0.3},"id":"evat20r","defaultValue":"","sort":""}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Start Date","labelPosition":"top","labelWidth":"","labelMargin":"","displayInTimezone":"submission","useLocaleSettings":false,"allowInput":true,"format":"yyyy-MM-dd","placeholder":"","description":"","tooltip":"","customClass":"","tabindex":"","hidden":false,"hideLabel":false,"autofocus":false,"disabled":false,"tableView":false,"modalEdit":false,"shortcutButtons":[],"enableDate":true,"enableMinDateInput":false,"datePicker":{"minDate":null,"maxDate":null,"disable":"","disableFunction":"","disableWeekends":false,"disableWeekdays":false,"datepickerMode":"day","showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5},"enableMaxDateInput":false,"enableTime":false,"timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":false,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"multiple":false,"defaultValue":"","defaultDate":"","customOptions":{},"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"onload","clearOnHide":true,"customDefaultValue":"","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validate":{"required":true,"customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"unique":false,"validateOn":"change","errorLabel":"","errors":"","key":"works.start_date","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"startDateChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"startDateChangeAction","type":"customAction","customAction":"var object = result[1];\nif(object && object.changed.component.key==='works.start_date') {\n  value = moment(value).format('YYYY-MM-DD');\n  instance.emit('onPhaseGridChanged',{});\n}\n\n\n\n"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"datetime","timezone":"","input":true,"widget":{"type":"calendar","displayInTimezone":"submission","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":true,"minDate":null,"disabledDates":"","disableWeekends":false,"disableWeekdays":false,"disableFunction":"","maxDate":null},"eaactworktypestartdate":"NaN","prefix":"","suffix":"","refreshOn":"","dataGridLabel":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"datepickerMode":"day","id":"eagces"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4}],"key":"columns4","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"euuce8"}],"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"theme":"default","breadcrumb":"default","id":"efjzr2"},{"title":"Work Details","collapsible":false,"key":"work","type":"panel","label":"Panel","input":false,"tableView":false,"components":[{"label":"Columns","columns":[{"components":[{"label":"Project","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}projects","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"works.project_id","logic":[{"name":"projectChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"projectChangeAction","type":"customAction","customAction":"var object = result[1];\nif(object && object.changed.component.key === 'works.project_id') {\n  var engagements = submission.data.engagements;\n  if(engagements && engagements.length > 0 ) {\n    _.forEach(engagements,function(engagement){\n      engagement.work_engagements.project_id = value;\n    });\n  \n  }\n}"}]}],"type":"select","selectValues":"projects","input":true,"lazyLoad":false,"disableLimit":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"ei6sees"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Minister","labelPosition":"top","widget":"choicesjs","labelWidth":"","labelMargin":"","placeholder":"","description":"","tooltip":"","customClass":"","tabindex":"","hidden":false,"hideLabel":false,"uniqueOptions":false,"autofocus":false,"disabled":false,"tableView":true,"modalEdit":false,"multiple":false,"dataSrc":"url","data":{"values":[{"label":"","value":""}],"resource":"","json":"","url":"{{data.reportapiurl}}codes/ministries","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"custom":""},"dataType":"","idPath":"id","valueProperty":"id","limit":100,"template":"<span>{{ item.combined }}</span>","refreshOn":"","refreshOnBlur":"","clearOnRefresh":false,"searchEnabled":true,"selectThreshold":0.3,"readOnlyValue":false,"customOptions":{},"useExactSearch":false,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"clearOnHide":true,"customDefaultValue":"","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":true,"onlyAvailableItems":false,"customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"unique":false,"errorLabel":"","errors":"","key":"works.ministry_id","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"select","indexeddb":{"filter":{}},"selectValues":"codes","selectFields":"","searchField":"","searchDebounce":0.3,"minSearch":0,"filter":"","redrawOn":"","input":true,"disableLimit":false,"prefix":"","suffix":"","dataGridLabel":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"lazyLoad":true,"authenticate":false,"ignoreCache":false,"fuseOptions":{"include":"score","threshold":0.3},"id":"eichcpg","defaultValue":"","sort":""},{"label":"currentPhaseId","customDefaultValue":"\r\n\r\nvar interval = setInterval(function(){\r\n  var phases = submission.data['works-work_phases'];\r\n  if(phases.length>0) {\r\n    var currentPhaseIndex = submission.data.actionType;\r\n    var currentPhase = phases[currentPhaseIndex];\r\n    instance.setValue(currentPhase.phase_id);\r\n    clearInterval(interval);\r\n  }\r\n},100);\r\n","key":"works.current_phase_id","type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"ehfjy8m"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Federal Involvement","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}codes/federal_involvements","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"works.federal_involvement_id","type":"select","selectValues":"codes","input":true,"disableLimit":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"ejzvwsp"},{"label":"id","key":"works.id","type":"hidden","input":true,"tableView":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"en2k66r"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4}],"key":"columns1","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"expp0ri"},{"label":"Columns","columns":[{"components":[{"label":"Title","tableView":true,"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"key":"works.title","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"eprwdv"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6},{"components":[{"label":"Anticipated Decision Date","labelPosition":"top","labelWidth":"","labelMargin":"","displayInTimezone":"viewer","useLocaleSettings":false,"allowInput":true,"format":"yyyy-MM-dd","placeholder":"","description":"","tooltip":"","customClass":"","tabindex":"","hidden":false,"hideLabel":false,"autofocus":false,"disabled":true,"tableView":false,"modalEdit":false,"shortcutButtons":[],"enableDate":true,"enableMinDateInput":false,"datePicker":{"minDate":null,"maxDate":null,"disable":"","disableFunction":"","disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5},"enableMaxDateInput":false,"enableTime":true,"timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"multiple":false,"defaultValue":"","defaultDate":"","customOptions":{},"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","clearOnHide":true,"customDefaultValue":"","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validate":{"required":false,"customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"unique":false,"validateOn":"change","errorLabel":"","errors":"","key":"works.anticipated_decision_date","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"datetime","timezone":"","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disabledDates":"","disableWeekends":false,"disableWeekdays":false,"disableFunction":"","maxDate":null},"prefix":"","suffix":"","refreshOn":"","dataGridLabel":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"datepickerMode":"day","id":"e25okj"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6}],"key":"columns","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"egegmm"},{"label":"Short Description","autoExpand":false,"tableView":true,"key":"works.short_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"rows":3,"wysiwyg":false,"editor":"","fixedSize":true,"id":"erfg83"},{"label":"Long Description","rows":6,"autoExpand":false,"tableView":true,"key":"works.long_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"wysiwyg":false,"editor":"","fixedSize":true,"id":"e5l15fl"},{"label":"PECP Required","tableView":false,"defaultValue":false,"key":"works.is_pcep_required","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"ewoic15"},{"label":"CAC Required","tableView":false,"defaultValue":false,"key":"works.is_cac_recommended","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"ep2eenb"},{"label":"Columns","columns":[{"components":[{"label":"Short Status","autoExpand":false,"tableView":true,"key":"works.work_short_status","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"rows":3,"wysiwyg":false,"editor":"","fixedSize":true,"id":"elp6hap"}],"width":8,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":8},{"components":[{"label":"Status Stoplight","widget":"choicesjs","tableView":true,"data":{"values":[{"label":"Red","value":"RED"},{"label":"Yellow","value":"YELLOW"},{"label":"Green","value":"GREEN"}],"json":"","url":"","resource":"","custom":""},"key":"works.work_status_stoplight","type":"select","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"dataSrc":"values","valueProperty":"","lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"template":"<span>{{ item.label }}</span>","selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"enbyvpi"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4}],"key":"columns3","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"equclnf"},{"label":"Active","tableView":false,"key":"works.is_active","type":"checkbox","input":true,"defaultValue":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"eikcb9"},{"label":"Tabs","components":[{"label":"Phases","key":"phases","components":[{"label":"PhaseGrid","labelPosition":"top","labelWidth":"","labelMargin":"","description":"","tooltip":"","customClass":"","tabindex":"","openWhenEmpty":false,"disableAddingRemovingRows":true,"conditionalAddButton":"","hidden":false,"hideLabel":true,"autofocus":false,"disabled":false,"tableView":true,"modalEdit":false,"templates":{"header":"<div class=\"row\">\n      {% util.eachComponent(components, function(component) { %}\n        {% if (displayValue(component)) { %}\n          <div class=\"col-sm-2\">{{ t(component.label) }}</div>\n        {% } %}\n        \n      {% }) %}\n    </div>","tableHeader":"\n      <tr>\n        {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">{{ component.label }}</td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">Actions</td>\n        {% } %}\n      </tr>\n    ","row":"<div class=\"row\">\r\n\r\n      {% util.eachComponent(components, function(component) { %}\r\n        {% if (displayValue(component)) { %}\r\n          <div class=\"col-sm-2\">\r\n            {{ isVisibleInRow(component) ? getView(component, row[component.key]) : ''}}\r\n          </div>\r\n        {% } %}\r\n      {% }) %}\r\n\t  \r\n      {% if (false!==false) { %}\r\n        <div class=\"col-sm-2\">\r\n          <div class=\"btn-group pull-right\">\r\n            <button class=\"btn btn-default btn-light btn-sm editRow\"><i class=\"{{ iconClass('edit') }}\"></i></button>\r\n          </div>\r\n        </div>\r\n      {% } %}\r\n\t  \r\n    </div>","tableRow":"\n      {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">\n              {{ getView(component, row[component.key]) }}\n            </td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">\n            <div class=\"btn-group\">\n              <button class=\"btn btn-default btn-light btn-sm editRow\" aria-label=\"{{ t('Edit row') }}\"><i class=\"{{ iconClass('edit') }}\"></i></button>\n              {% if (!instance.hasRemoveButtons || instance.hasRemoveButtons()) { %}\n              <button class=\"btn btn-danger btn-sm removeRow\" aria-label=\"{{ t('Remove row') }}\"><i class=\"{{ iconClass('trash') }}\"></i></button>\n              {% } %}\n            </div>\n          </td>\n        {% } %}\n    ","footer":""},"rowClass":"","addAnother":"Add Phase","modal":false,"saveRow":"","removeRow":"Cancel","persistent":true,"inlineEdit":false,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"eaactworktypestartdate","clearOnHide":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":false,"minLength":"","maxLength":"","customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"rowDrafts":false,"errorLabel":"","errors":"","key":"works-work_phases","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"PhaseGridChangeLogic","trigger":{"type":"event","event":"onPhaseGridChanged"},"actions":[{"name":"PhaseGridChangeAction","type":"customAction","customAction":"// this block has to be executed only if the below mentioned fields are set with proper values\r\nvar work_type_id = submission.data.works.work_type_id;\r\nvar ea_act_id = submission.data.works.ea_act_id;\r\nvar start_date = submission.data.works.start_date;\r\nvar hasValue = data.onload.hasValue;\r\nvar dateFormat = 'YYYY-MM-DD';\r\n// var start_date_hidden = submission.data['start_date']\r\n// applicationId empty means the form is being submitted for the first time. Only then the api call has to be initiated to fill the table\r\nif (!hasValue(data.applicationId)\r\n    && hasValue(work_type_id)\r\n    && hasValue(ea_act_id)\r\n    && hasValue(start_date)) {\r\n    try {\r\n        var phases = [];\r\n        var events = [];\r\n        var engagements = [];\r\n        var baseUrl = data.reportapiurl;\r\n        var headers = {\r\n            headers: {\r\n                Authorization: 'Bearer ' + localStorage.getItem('authToken')\r\n            }\r\n        }\r\n        fetch(baseUrl + \"phases/ea_acts/\" + ea_act_id + \"/work_types/\" + work_type_id, headers)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                if (data) {\r\n                    data.forEach(function (phase, index) {\r\n                        var edate = moment(start_date).add(phase.duration, 'days');\r\n                        // filling in the phases grid\r\n                        phases.push({\r\n                            id: '',\r\n                            phase_id: phase.id,\r\n                            phasename: phase.name,\r\n                            eaactlabel: phase.ea_act.name,\r\n                            legislated: phase.legislated,\r\n                            duration: phase.duration,\r\n                            durationlabel: phase.duration,\r\n                            start_date: moment(start_date).format(dateFormat),\r\n                            anticipated_end_date: moment(edate).format(dateFormat)\r\n                        });\r\n                        // milestones marked as EVENT as event_type and auto population turned on\r\n                        var autoPopulatedEvents = phase.milestones.filter(p => p.kind === 'EVENT' && p.auto === true);\r\n                        autoPopulatedEvents.forEach((event, event_index) => {\r\n                            var event_start_date = moment(start_date).add(event.start_at, 'days');\r\n                            var event_end_date = event_start_date.add(event.duration, 'days');\r\n                            events.push({\r\n                                id: '',\r\n                                title: event.name,\r\n                                allowEditing: true,\r\n                                phaselabel: phase.name,\r\n                                eaactlabel: phase.ea_act.name,\r\n                                milestonelabel: event.name, // same as that of milestone\r\n                                anticipated_start_date: moment(event_start_date).format(dateFormat),\r\n                                anticipated_end_date: moment(event_end_date).format(dateFormat),\r\n                                milestone_id: event.id,\r\n                                milestone_type_name: event.milestone_type.name,\r\n                                isfixedevent: true,\r\n                                isendevent: (event_index === autoPopulatedEvents.length - 1),\r\n                                phaseindex: index,\r\n                                duration: event.duration,\r\n                                index: events.length\r\n                            });\r\n                        })\r\n                        // milestones marked as ENGAGEMENT as event_type and auto population turned on \r\n                        var autoPopulatedEngagements = phase.milestones.filter(p => p.kind === 'ENGAGEMENT' && p.auto === true);\r\n                        autoPopulatedEngagements.forEach((engagement, eng_index) => {\r\n                            var engagement_start_date = moment(start_date).add(engagement.start_at, 'days');\r\n                            var engagement_end_date = moment(engagement_start_date).add(engagement.duration, 'days');\r\n                            engagements.push({\r\n                                phase_label: phase.name,\r\n                                title: engagement.name,\r\n                                start_date: moment(engagement_start_date).format(dateFormat),\r\n                                end_date: moment(engagement_end_date).format(dateFormat),\r\n                                id: '',\r\n                                phaseindex: index,\r\n                                correlationkey: ['PECP Coming','PECP','PECP Open','PECP Closing'].includes(engagement.milestone_type.name)?'default':'',\r\n                                duration: engagement.duration,\r\n                                milestone_type_name: engagement.milestone_type.name,\r\n                                start_at: engagement.start_at,\r\n                                \"work_engagements\": {\r\n                                    phase_id: phase.id,\r\n                                    id: '',\r\n                                    project_id: submission.data.works.project_id,\r\n                                    work_type_id: submission.data.works.work_type_id,\r\n                                    milestone_id: engagement.id,\r\n                                    engagement_id: ''\r\n                                }\r\n                            });\r\n                        })\r\n                        daysToBeAdded = phase.duration;\r\n                        start_date = moment(edate).add(1, 'days');\r\n                    });\r\n                    submission.data['works-phases'] = phases;\r\n                    instance.setValue(phases);\r\n                    var eventsGrid = utils.getComponent(instance.parent.components, 'works-events');\r\n                    var engagementsGrid = utils.getComponent(instance.parent.components, 'engagements');\r\n                     var anticipated_decision_date;\r\n                    try {\r\n                        \r\n                        utils.findComponent(instance.root.components, 'works.anticipated_decision_date', ['works.anticipated_decision_date'], (components) => {\r\n                            anticipated_decision_date = components\r\n                        })\r\n                    } catch (e) { console.error(e.message) };\r\n                    anticipated_decision_date.setValue(phases[phases.length - 1].anticipated_end_date);\r\n                    submission.data['works-events'] = events;\r\n                    submission.data.engagements = engagements;\r\n                    eventsGrid.setValue(events);\r\n                    engagementsGrid.setValue(engagements);\r\n                    instance.emit('onEventsGridChanged', {});\r\n                } else {\r\n                    value = [];\r\n                }\r\n            });\r\n\r\n    } catch (e) {\r\n        console.log('error', e.message);\r\n    }\r\n}"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"editgrid","displayAsTable":false,"input":true,"components":[{"label":"Columns","columns":[{"components":[{"label":"Phase","tableView":true,"key":"phasename","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"eins9cpg"},{"label":"Start Date","format":"yyyy-MM-dd","tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"key":"start_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"enableTime":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"ernnqa"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6},{"components":[{"label":"Duration","tableView":true,"key":"durationlabel","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"erwxqko"},{"label":"End Date","format":"yyyy-MM-dd","tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"key":"anticipated_end_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"enableTime":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"elhdytj5"},{"label":"Legislated","tableView":true,"defaultValue":false,"key":"legislated","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"el28ja"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6}],"key":"columns","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"eyjhym9"}],"placeholder":"","prefix":"","suffix":"","multiple":false,"defaultValue":null,"unique":false,"refreshOn":"","dataGridLabel":false,"widget":null,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"defaultOpen":false,"id":"eq6ppjc"}]},{"label":"Events","key":"event","components":[{"label":"EventsGrid","labelPosition":"top","labelWidth":"","labelMargin":"","description":"","tooltip":"","customClass":"","tabindex":"","openWhenEmpty":false,"disableAddingRemovingRows":false,"conditionalAddButton":"show = Boolean(data.applicationId)","hidden":false,"hideLabel":true,"autofocus":false,"disabled":false,"tableView":false,"modalEdit":false,"templates":{"header":"<div class=\"row\">\r\n      {% util.eachComponent(components, function(component) { %}\r\n        {% if (displayValue(component)) { %}\r\n          <div class=\"col-sm-2\">{{ t(component.label) }}</div>\r\n        {% } %}\r\n      {% }) %}\r\n    </div>","tableHeader":"\n      <tr>\n        {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">{{ component.label }}</td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">Actions</td>\n        {% } %}\n      </tr>\n    ","row":"<div class=\"row\">\r\n      {% util.eachComponent(components, function(component) { %}\r\n{% if (parseInt(row['phaseindex'])>parseInt(submission.data.activephase) && component.attributes.type && component.attributes.type === 'select') { %}\r\n{% (flattenedComponents[component.key]).parentDisabled=true; %}\r\n{% } else if(row['allowEditing'] === false || data.applicationId === \"\"){ %}\r\n{% (flattenedComponents[component.key]).disabled=true; %}\r\n{% } else { %}\r\n{% if(!['end_date','anticipated_end_date'].includes(component.key)){(flattenedComponents[component.key]).disabled=false;} %}\r\n{% } %}\r\n        {% if (displayValue(component)) { %}\r\n          <div class=\"col-sm-2\">\r\n            {{ isVisibleInRow(component) ? getView(component, row[component.key]) : ''}}\r\n          </div>\r\n        {% } %}\r\n      {% }) %}  \r\n      {% if (!instance.options.readOnly && !instance.disabled) { %}\r\n        <div class=\"col-sm-0\">\r\n          <div class=\"btn-group pull-right\">\r\n            <button class=\"btn btn-default btn-light btn-sm editRow\"><i class=\"{{ iconClass('edit') }}\"></i></button>\r\n            {% if (row['isfixedevent']!=true) { %}\r\n              <button class=\"btn btn-danger btn-sm removeRow\"><i class=\"{{ iconClass('trash') }}\"></i></button>\r\n       {% } %}\r\n          </div>\r\n        </div>\r\n      {% } %}\r\n\r\n</div>","tableRow":"\n      {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">\n              {{ getView(component, row[component.key]) }}\n            </td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">\n            <div class=\"btn-group\">\n              <button class=\"btn btn-default btn-light btn-sm editRow\" aria-label=\"{{ t('Edit row') }}\"><i class=\"{{ iconClass('edit') }}\"></i></button>\n              {% if (!instance.hasRemoveButtons || instance.hasRemoveButtons()) { %}\n              <button class=\"btn btn-danger btn-sm removeRow\" aria-label=\"{{ t('Remove row') }}\"><i class=\"{{ iconClass('trash') }}\"></i></button>\n              {% } %}\n            </div>\n          </td>\n        {% } %}\n    ","footer":""},"rowClass":"","addAnother":"Add Event","modal":false,"saveRow":"","removeRow":"Cancel","persistent":true,"inlineEdit":false,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","clearOnHide":true,"customDefaultValue":"","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":true,"minLength":"","maxLength":"","customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"rowDrafts":false,"errorLabel":"","errors":"","key":"works-events","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"eventsGridSaveRowLogic","trigger":{"type":"event","event":"editGridSaveRow"},"actions":[{"name":"EventsGridSaveRowAction","type":"customAction","customAction":"try {    \r\n    const rebindGrids = () => {\r\n        var eventsGrid = utils.getComponent(instance.parent.components, 'works-events');\r\n        var phaseGrid = utils.getComponent(instance.parent.components, 'works-work_phases');\r\n        var anticipated_decision_date;\r\n        try {\r\n\r\n            utils.findComponent(instance.root.components, 'works.anticipated_decision_date', ['works.anticipated_decision_date'], (components) => {\r\n                anticipated_decision_date = components\r\n            })\r\n        } catch (e) { console.error(e.message) };\r\n        anticipated_decision_date.setValue(phases[phases.length - 1].anticipated_end_date);\r\n        eventsGrid.resetValue();\r\n        eventsGrid.setValue(events);\r\n        phaseGrid.setValue(phases);\r\n        setTimeout(function () {\r\n            \r\n        }, 100);\r\n        instance.emit('eventsGridChanged', {});\r\n    }\r\n    const isStartEvent = (e) => {\r\n        var filteredEvents = events.filter(p => p.phaseindex === e.phaseindex);\r\n        return e.index === filteredEvents[0].index;\r\n    }\r\n    const isEndEvent = (e) => {\r\n        var filteredEvents = events.filter(p => p.phaseindex === e.phaseindex);\r\n        var doesEventDatesPushOut = e.index === filteredEvents[filteredEvents.length - 1].index;\r\n        if(['Extension','Suspension'].includes(e.milestone_type_name)) {\r\n            doesEventDatesPushOut = true;\r\n        }\r\n        return doesEventDatesPushOut;\r\n    }\r\n    const cancelEditActualDates = (newEvent) =>{\r\n        var date_ctrl = newEvent.end_date && newEvent.end_date !== \"\" ? 'start_date' : 'anticipated_start_date';\r\n        var end_date = date_ctrl.replace('start_date', 'end_date');\r\n        events[newEvent.index][date_ctrl] = moment(newEvent[date_ctrl]).add((diff * -1), 'days').format(dateFormat);\r\n        events[newEvent.index][end_date] = events[newEvent.index][date_ctrl]\r\n        rebindGrids();\r\n    }\r\n    const calculateDateChanges = (newEvent) => {\r\n        var eventPhase = phases[newEvent.phaseindex];\r\n        const dateToCheck = (e) => (e.end_date && e.end_date != \"\") ? e.end_date : e.anticipated_end_date;\r\n        var date_to_check = moment(dateToCheck(newEvent));\r\n        var diff = date_to_check.startOf('day').diff(moment(isStartEvent(newEvent) ? eventPhase.start_date : eventPhase.anticipated_end_date).startOf('day'), 'days');\r\n        var alertDiaglogText = `Actual End Date (${date_to_check.format('YYYY-MM-DD')}) falls outside the start/end dates of the selected phase(${moment(eventPhase.start_date).format(dateFormat)} to ${moment(eventPhase.anticipated_end_date).format(dateFormat)}). Do you want to continue?`;\r\n        if(diff > 0 && (!isStartEvent(newEvent) && !isEndEvent(newEvent))) {\r\n            if(!confirm(alertDiaglogText)){\r\n                cancelEditActualDates(newEvent);\r\n                return value;\r\n            }\r\n        }\r\n        else if (diff !== 0 && (isStartEvent(newEvent) || isEndEvent(newEvent))) {\r\n            if (confirm(alertDiaglogText)) {\r\n                    var phase_start_date;\r\n                    phases.forEach((phase, phaseIndex) => {\r\n                        if (phaseIndex >= newEvent.phaseindex) {\r\n                            var eventsPerPhase = events.filter(e => e.phaseindex === phaseIndex);\r\n                            eventsPerPhase.forEach((event) => {\r\n                                if (event.index > newEvent.index) {\r\n                                    var eventDiff = moment(event.anticipated_end_date).diff(moment(event.anticipated_start_date), 'days');\r\n                                    event.anticipated_start_date = moment(event.anticipated_start_date).add(diff, 'days').format(dateFormat);\r\n                                    event.anticipated_end_date = moment(event.anticipated_start_date).add(eventDiff, 'days').format(dateFormat);\r\n    \r\n                                    if (event.end_date && event.end_date != \"\" && event.start_date && event.start_date != \"\") {\r\n                                        var actualDiff = moment(event.end_date).diff(moment(event.start_date), 'days');\r\n                                        event.start_date = moment(event.start_date).add(diff, 'days').format(dateFormat);\r\n                                        event.end_date = moment(event.start_date).add(actualDiff, 'days').format(dateFormat);\r\n                                    }\r\n                                }\r\n                            });\r\n                            var firstEvent = eventsPerPhase[0];\r\n                            if (phaseIndex === newEvent.phaseindex) {\r\n                                phase.diff = (phase.diff ? phase.diff : 0);\r\n                                if (isEndEvent(newEvent)) {\r\n                                    phase.diff += diff;\r\n                                }\r\n                                if (isEndEvent(newEvent)) {\r\n                                    if (phase.legislated) {\r\n                                        if (phase.diff !== 0) phase.durationlabel = phase.duration + '(' + (phase.diff > 0 ? '+' : '-') + (Math.abs(phase.diff)) + ')';\r\n                                        else phase.durationlabel = phase.duration;\r\n                                    } else {\r\n                                        phase.durationlabel = (phase.duration + phase.diff)\r\n                                    }\r\n                                }\r\n                                phase.start_date = moment(firstEvent.start_date && firstEvent.start_date != \"\" ? firstEvent.start_date : firstEvent.anticipated_start_date).format(dateFormat);\r\n                                phase.anticipated_end_date = moment(phase.anticipated_end_date).add(diff, 'days').format(dateFormat);\r\n                            } else {\r\n                                phase.start_date = phase_start_date;\r\n                                phase.anticipated_end_date = moment(phase_start_date).add(phase.duration, 'days').format(dateFormat);\r\n                            }\r\n                            phase_start_date = moment(phase.anticipated_end_date).add(1, 'days').format(dateFormat);\r\n                        }\r\n                    });\r\n                instance.emit('phaseDatesChanged',{phaseindex: newEvent.phaseindex,datediff: diff,isStartEvent:isStartEvent(newEvent)});\r\n                \r\n            } else {\r\n                cancelEditActualDates(newEvent);\r\n                return value;\r\n            }\r\n        }\r\n    }\r\n    const generateRandomKey = () => {\r\n        var text = \"\";\r\n        var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n\r\n        for (var i = 0; i < 5; i++)\r\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\r\n\r\n        return text;\r\n    }\r\n    const getMilestones = (phase_id,newEvent) => {\r\n        try {\r\n            var headers = {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + localStorage.getItem('authToken')\r\n                }\r\n            }\r\n            return new Promise((resolve, reject) => {\r\n                fetch(data.reportapiurl + 'milestones/phases/' + phase_id, headers)\r\n                    .then(response => response.json())\r\n                    .then(data => {\r\n                        resolve({data,newEvent,rebindGrids});\r\n                    })\r\n                    .catch(err => reject(err))\r\n            });\r\n        } catch (e) {\r\n            console.log(e.message);\r\n        }\r\n    }\r\n    const formatEventDates = (newEvent) => {\r\n        // formatting the dates\r\n        newEvent.anticipated_start_date = moment(newEvent.anticipated_start_date).format(dateFormat);\r\n        newEvent.anticipated_end_date = moment(newEvent.anticipated_end_date).format(dateFormat);\r\n        if (newEvent.start_date && newEvent.start_date !== \"\") {\r\n            newEvent.start_date = moment(newEvent.start_date).format(dateFormat);\r\n        }\r\n        if (newEvent.end_date && newEvent.end_date !== \"\") {\r\n            newEvent.end_date = moment(newEvent.end_date).format(dateFormat);\r\n        }\r\n        if (newEvent.is_complete && newEvent.is_complete === true) {\r\n            return value;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    debugger\r\n    var dateFormat = 'YYYY-MM-DD';\r\n    var newEvent = result[0].row;\r\n    // if the saved event is already completed, no need to run throught the logic\r\n    if(data.applicationId===\"\" ||  (newEvent.is_complete && newEvent.is_complete === true)) {\r\n        alert('Invalid operation');\r\n        return value;\r\n    }\r\n    formatEventDates(newEvent);\r\n    var events = submission.data['works-events'];\r\n    var phases = submission.data['works-work_phases'];\r\n    var insertIndex = newEvent.index;\r\n    if (newEvent.phaseindex === undefined) {\r\n        // inserting new object to the right place\r\n        insertIndex = events.findIndex(p => p.phaseindex === data.activephase && p.isendevent === true);\r\n        newEvent.phaseindex = data.activephase;\r\n        events.splice(insertIndex, 0, newEvent);\r\n        events.splice(events.length - 1, 1);\r\n        if(newEvent.milestone_type_name === 'PECP') {\r\n            events[insertIndex].correlationkey = generateRandomKey();\r\n            getMilestones(phases[newEvent.phaseindex].phase_id,events[insertIndex]).then(result=>{\r\n                var newEvent = result.newEvent;\r\n                var phases = submission.data['works-work_phases'];\r\n                var phase = phases[newEvent.phaseindex];\r\n                var pecpCloseMilestone = result.data.filter(p=>p.name === 'PECP Close' && p.kind === 'EVENT')[0];\r\n                var pecpCloseEvent = {\r\n                    id: '',\r\n                    title: pecpCloseMilestone.name,\r\n                    allowEditing: false,\r\n                    phaselabel: phase.name,\r\n                    eaactlabel: phase.eaactlabel,\r\n                    milestonelabel: pecpCloseMilestone.name, // same as that of milestone\r\n                    anticipated_start_date: newEvent.anticipated_end_date, //pecp close will at the end of pecp\r\n                    anticipated_end_date: newEvent.anticipated_end_date,\r\n                    start_date: newEvent.end_date,\r\n                    end_date: newEvent.end_date,\r\n                    milestone_id: pecpCloseMilestone.id,\r\n                    milestone_type_name: pecpCloseMilestone.milestone_type.name,\r\n                    isfixedevent: true,\r\n                    isendevent: false,\r\n                    phaseindex: newEvent.phaseindex,\r\n                    duration: newEvent.number_of_days,\r\n                    index: events.length,\r\n                    correlationkey: newEvent.correlationkey,\r\n                    never_edit: true\r\n                }\r\n                events.splice(newEvent.index+1, 0, pecpCloseEvent);\r\n                events.splice(events.length - 1, 1);\r\n                events.forEach((event, index) => event.index = index);\r\n                result.rebindGrids();\r\n                if(newEvent.milestone_type_name === 'PECP') {\r\n                    var pecpClose = events[newEvent.index + 1]\r\n                    instance.emit('pecpEventUpdated',{pecp: newEvent,pecpClose,op:'insert'});\r\n                }\r\n            });\r\n        }         \r\n        // recalculating the index\r\n        events.forEach((event, index) => event.index = index);\r\n    }else{\r\n        if(newEvent.milestone_type_name === 'PECP') {\r\n            var pecpCloseEvent = events.filter(p=>p.correlationkey === newEvent.correlationkey && p.index !== newEvent.index)[0];\r\n            pecpCloseEvent.anticipated_start_date = newEvent.anticipated_end_date; //pecp close will at the end of pecp\r\n            pecpCloseEvent.anticipated_end_date = newEvent.anticipated_end_date;\r\n            pecpCloseEvent.start_date = newEvent.end_date;\r\n            pecpCloseEvent.end_date = newEvent.end_date;\r\n            var pecpClose = events[newEvent.index + 1]\r\n            instance.emit('pecpEventUpdated',{pecp: newEvent,pecpClose,op:'update'});\r\n        }\r\n    }\r\n    if (newEvent.end_date && newEvent.end_date !== \"\") {\r\n        if (newEvent.index !== 0) {\r\n            var prevEvent = events[newEvent.index - 1];\r\n            if (prevEvent.is_complete !== true) {\r\n                alert('Previous event is not yet completed. You cannot proceed unless you complete the previous event');\r\n                newEvent.start_date = \"\";\r\n                newEvent.end_date = \"\";\r\n                rebindGrids();\r\n                return value;\r\n            }\r\n        }\r\n        if (confirm('Event will be locked for future changes. Are you sure you want to proceed?')) {\r\n            events[newEvent.index].is_complete = true;\r\n            var phaseEvents = events.filter(p => p.phaseindex === newEvent.phaseindex);\r\n            if (newEvent.index === phaseEvents[phaseEvents.length - 1].index) {\r\n                submission.data.actionType = newEvent.phaseindex + 1;\r\n                submission.data.works.current_phase_id = phases[newEvent.phaseindex + 1].phase_id;\r\n            }\r\n            data.completedEventPhase = phases[newEvent.phaseindex].phasename;\r\n            data.completedEvent = newEvent.title;\r\n        }\r\n    }\r\n\r\n    // allow editing \r\n    events.forEach((e) =>e.allowEditing = !((e.end_date != \"\" && e.is_complete === true) || e.never_edit));\r\n    calculateDateChanges(newEvent);\r\n\r\n\r\n    // check to see if there are termination decisions have been chosen\r\n    var prevDiff = 0;\r\n    var outcomes = data.onload.outcomes;\r\n    for (var index = 0; index < events.length; index++) {\r\n        var event = events[index];\r\n        if (event.decision_id !== \"\" && event.is_active === true) {\r\n            var outcome = outcomes.filter(p => p.id === parseInt(event.decision_id));\r\n            if (outcome.length > 0 && outcome[0].terminates_work === true) {\r\n                if (confirm(\"Are you sure you want to terminate the work?\\n If you press 'Cancel', the event will be removed from the list.\")) {\r\n                    data.isworkterminated = true;\r\n                } else {\r\n                    data.isworkterminated = false;\r\n                    events.splice(index, 1);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    rebindGrids();\r\n\r\n} catch (e) {\r\n    console.error(e.message);\r\n}"}]},{"name":"editGridDeleteRowLogic","trigger":{"type":"event","event":"editGridDeleteRow"},"actions":[{"name":"editGridDeleteRowAction","type":"customAction","customAction":"debugger\r\nvar events = submission.data['works-events'];\r\nvar prevDeletedIndex = result[0].index;\r\nvar selectedEvent = events[prevDeletedIndex];\r\nif(selectedEvent && selectedEvent.milestone_type_name === 'PECP Close') {\r\n    events.splice(prevDeletedIndex, 1);\r\n    instance.emit('pecpEventUpdated',{pecpClose: selectedEvent, op: 'delete'});\r\n}\r\nevents.forEach((event, index) => event.index = index);\r\nvar outcomes = data.onload.outcomes;\r\nfor (var index = 0; index < events.length; index++) {\r\n    var event = events[index];\r\n    var outcome = outcomes.filter(p => p.id === parseInt(event.decision_id === \"\" ? 0 : event.decision_id));\r\n    if (outcome.length === 0) {\r\n        data.isworkterminated = false;\r\n    }\r\n}\r\nvalue = events;\r\ninstance.setValue(events);"}]},{"name":"eventsGridAddRowLogic","trigger":{"type":"event","event":"editGridAddRow"},"actions":[{"name":"eventsGridAddRowAction","type":"customAction","customAction":"var events = data['works-events'];\r\nself.editRows[self.editRows.length - 1].data.id='';\r\nvar currentPhase = events.filter(p=>p.phaseindex==data.activephase)[0];\r\nif(currentPhase) {\r\n data.currentphaselabel = currentPhase.phaselabel; \r\n data.currenteaactlabel = currentPhase.eaactlabel;\r\n}"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"editgrid","displayAsTable":false,"input":true,"components":[{"label":"HTML","tag":"div","className":"main-content-event-title","attrs":[{"attr":"","value":""}],"content":"<div class=\"label\">Phase</div>\r\n<div>{{row.phaselabel?row.phaselabel:data.currentphaselabel}}</div>\r\n<div class=\"label\">EA Act</div>\r\n<div>{{row.eaactlabel?row.eaactlabel:data.currenteaactlabel}}</div>\r\n <div class=\"label\">Milestone</div>\r\n  <div>{{row.milestonelabel?row.milestonelabel:data.currentmilestone}}</div>\r\n<style>\r\n  .main-content-event-title {\r\n    background-color: #b3d1ff;\r\n    padding: 0.5rem;\r\n    display: grid;\r\n    border-radius: 0.3rem;\r\n    grid-template-columns: 8% 30% 8% 15% 10% 30%;\r\n  }\r\n  .label {\r\n    font-weight: bold;\r\n  }\r\n</style>","refreshOnChange":true,"key":"html","type":"htmlelement","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"id":"e2wxr3g"},{"label":"Event Title","tableView":true,"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"key":"title","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"eswco5a"},{"label":"Short Description","autoExpand":false,"tableView":false,"key":"short_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"rows":3,"wysiwyg":false,"editor":"","fixedSize":true,"id":"eq61vhc"},{"label":"Long Description","rows":6,"autoExpand":false,"tableView":false,"key":"long_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"wysiwyg":false,"editor":"","fixedSize":true,"id":"et2g1ti"},{"label":"Columns","columns":[{"components":[{"label":"Milestone","widget":"choicesjs","tableView":false,"dataSrc":"custom","data":{"custom":"try {\r\n  var headers = {\r\n  headers: {\r\n  Authorization: 'Bearer '+localStorage.getItem('authToken')\r\n  }\r\n}\r\n    var milestones = [];\r\n    var phases = submission.data['works-work_phases'];\r\n    if (phases && phases.length > 0) {\r\n        var currentPhase = phases[data.activephase];\r\n        fetch(data.reportapiurl + 'milestones/phases/' + currentPhase.phase_id,headers)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                milestones = data.filter(p=>p.kind === 'EVENT').map(p => {\r\n                    return {\r\n                        value: p.id,\r\n                        label: p.name\r\n                    }\r\n                });\r\n                var filteredMilestones = milestones.filter(p=>!['PECP Close'].includes(p.label))\r\n                instance.setItems(filteredMilestones);\r\n\r\n            })\r\n    }\r\n\r\n} catch (e) {\r\n    console.log(e.message);\r\n}","values":[{"label":"","value":""}],"json":"","url":"","resource":""},"idPath":"","clearOnHide":false,"validate":{"custom":"try {\n  if(row['isfixedevent']===true) {\n    valid = true;\n  }else{\n    valid = row['milestone_id']!==\"\"?true: 'Milestone is required';\n  }\n}catch(e) {\n  console.log('Error from milestone: works-events',e.message);\n}\n","required":false,"customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"milestone","conditional":{"show":true,"when":null,"eq":""},"customConditional":"\n\n  // make the milestone dropdown invisible if \n// the event rows are prepopulated\nif(row.isfixedevent === true) {\n  show = false;\n}\n","logic":[{"name":"milestoneChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"milestoneChangeAction","type":"customAction","customAction":"var object = result[1];\r\nif (object && object.changed.component.key === 'milestone') {\r\n    var headers = {\r\n        headers: {\r\n            Authorization: 'Bearer ' + localStorage.getItem('authToken')\r\n        }\r\n    }\r\n    fetch(data.reportapiurl + 'milestones/' + value.value, headers)\r\n        .then(response => response.json())\r\n        .then(data => callback(instance, row, data))\r\n\r\n    if (value !== \"\") {\r\n        data.currentmilestone = value.label;\r\n    } else {\r\n        data.currentmilestone = \"\";\r\n    }\r\n}\r\n\r\nfunction callback(instance, row, data) {\r\n    try {\r\n        var result;\r\n        utils.findComponent(instance.root.components, 'anticipated_end_date', ['anticipated_end_date'], (components) => {\r\n            result = components\r\n        })\r\n    } catch (e) { console.error(e.message) };\r\n    result.setValue(data.milestone_type.name);\r\n    row.milestone_type_name = data.milestone_type.name;\r\n}\r\n"}]}],"type":"select","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"clearOnRefresh":false,"limit":100,"valueProperty":"","lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"template":"<span>{{ item.label }}</span>","selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"e0r97jp"},{"label":"Milestone","key":"milestone_type_name","type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"ek44so8"},{"label":"milestoneId","key":"milestone_id","logic":[{"name":"eventsGridRowChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"eventsGridRowChangeAction","type":"customAction","customAction":"if(row['milestone']['value']) {\n  instance.setValue(row['milestone']['value']);\n}"}]}],"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"e278hs7"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6},{"components":[{"label":"Decision","widget":"choicesjs","tableView":false,"dataSrc":"custom","data":{"custom":"try {\r\n  var headers = {\r\n  headers: {\r\n  Authorization: 'Bearer '+localStorage.getItem('authToken')\r\n  }\r\n}\r\n  if(row['milestone_id']){\r\n    var outcomes = [];\r\n        fetch(data.reportapiurl + 'outcomes/milestones/' + row['milestone_id'],headers)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n\r\n                outcomes = data.map(p => {\r\n                    return {\r\n                        value: p.id,\r\n                        label: p.name\r\n                    }\r\n                });\r\n                values = outcomes;\r\n                instance.setItems(outcomes);\r\n\r\n            }) \r\n  }\r\n} catch (e) {\r\n    console.log(e.message);\r\n}","values":[{"label":"","value":""}],"json":"","url":"","resource":""},"refreshOn":"works-events.milestone","customDefaultValue":"value='';","key":"decision","customConditional":"if(row.isfixedevent === true) {\n  show = false;\n}","attributes":{"type":"select"},"type":"select","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"calculateValue":"","calculateServer":false,"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"valueProperty":"","lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"template":"<span>{{ item.label }}</span>","selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"eggiza5"},{"label":"decisionId","key":"decision_id","logic":[{"name":"eventsGridRowChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"eventsGridRowChangeAction","type":"customAction","customAction":"\nif(row['decision']['value']) {\n  instance.setValue(row['decision']['value']);\n}else {\n  instance.setValue('');\n}"}]}],"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"etp944f"}],"width":6,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":6}],"key":"columns1","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"eh9k32n"},{"label":"Columns","columns":[{"components":[{"label":"Anticipated Start Date","displayInTimezone":"submission","format":"yyyy-MM-dd","tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"customDefaultValue":"var interval = setInterval(function(){\r\n  var events = submission.data['works-events'];\r\n  if(events && events.length > 0) {\r\n    var startEvent = events.filter(p=>p.phaseindex === data.activephase)[0];\r\n    if(startEvent) {\r\n      instance.setValue(startEvent.anticipated_start_date);\r\n    }\r\n    clearInterval(interval);\r\n  }\r\n \r\n},100);\r\n","validate":{"required":true,"custom":"try{\n  var start_date = data.works.start_date;\n  var anticipated_start_date = row['anticipated_start_date'];\n  if(start_date.length === 0) {\n    valid = \"Please choose Start Date\";\n  }else if(start_date.length > 0 && anticipated_start_date.length > 0){\n    var thisdate = moment(anticipated_start_date);\n    var diff = thisdate.diff(moment(start_date),'days');\n    valid = diff>=0?true:'Anticipated start date cannot be lower than the work\\'s start date';\n  }\n}catch(e) {\n  console.log('Error from anticipated start date: works', e.message);\n}","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"key":"anticipated_start_date","logic":[{"name":"anticipatedStartDateChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"anticipatedStartDateChangeAction","type":"customAction","customAction":"var object = result[1];\nif(object && object.changed.component.key==='anticipated_start_date') {\n  var events = data['works-events'];\n  var phases = submission.data['works-work_phases'];\n  const isStartEvent = (e, pindex) => {\n        var filteredEvents = events.filter(p => p.phaseindex === pindex);\n        return e.index === filteredEvents[0].index;\n    }\n    const isEndEvent = (e, pindex) => {\n        var filteredEvents = events.filter(p => p.phaseindex === pindex);\n        return e.index === filteredEvents[filteredEvents.length - 1].index;\n    }\n    \n  var number_of_days = row['number_of_days'];\n  if(number_of_days) {\n    row['anticipated_end_date'] = moment(value).add(parseInt(number_of_days),'days');\n  }else{\n   row['anticipated_end_date'] = value; \n  }\n    var eventPhase = phases[row.phaseindex];\n    const dateToCheck = (e) => (e.end_date && e.end_date != \"\") ? e.end_date : e.anticipated_end_date;\n    var date_to_check = moment(dateToCheck(row));\n    var diff = date_to_check.diff(moment(isStartEvent(row, row.phaseindex) ? eventPhase.start_date : eventPhase.anticipated_end_date), 'days');\n    // if(diff>0) {\n    //   row.is_valid = false;\n    // }\n    // else row.is_valid = true;\n}\n\n\n    "}]}],"type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"submission","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"etp314q"},{"label":"Anticipated End Date","format":"yyyy-MM-dd","disabled":true,"tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"redrawOn":"data","customDefaultValue":"debugger\r\nvar anticipated_start_date = row['anticipated_start_date'];\r\nvar interval = setInterval(function(){\r\n  var phases = submission.data['works-work_phases'];\r\n  if(phases && phases.length>0) {\r\n    var currentPhaseIndex = submission.data.activephase;\r\n    var currentPhase = phases[currentPhaseIndex];\r\n    if(currentPhase) {\r\n     instance.setValue(currentPhase.anticipated_end_date); \r\n    }\r\n    clearInterval(interval);\r\n  }\r\n},100);\r\n","validate":{"custom":"try{\n  var aniticipatedEndDate = row['anticipated_end_date'];\n  var startDate = row['anticipated_start_date'];\n  if(startDate.length === 0) {\n    valid = \"Please choose Start Date\";\n  }else if(startDate.length > 0 && aniticipatedEndDate.length > 0){\n    var start_date = moment(startDate);\n    var thisdate = moment(aniticipatedEndDate);\n    var diff = thisdate.diff(start_date,'days');\n    valid = diff>=0?true:'Anticipated end date should be higher than Start Date';\n  }else if(aniticipatedEndDate.length === 0) {\n    valid = 'Please select Anticipated Decision Date';\n  }\n}catch(e) {\n  console.log('Error from anticipated decision date: works', e.message);\n}","required":false,"customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"key":"anticipated_end_date","customConditional":"show = Boolean(['PECP','Extension','Suspension'].includes(row['milestone_type_name']))","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"eftgwn"},{"label":"Active","hidden":true,"tableView":false,"defaultValue":false,"clearOnHide":false,"key":"is_active","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"ex05kd"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Actual Start Date","format":"yyyy-MM-dd","tableView":false,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"validate":{"custom":"try{\n  if(row['is_complete'] === true && row['start_date']===\"\") {\n    valid = 'Please select start date';\n  }\n  var anticipatedStartDate = row['anticipated_start_date'];\n  var actual_start_date = row['start_date'];\n  var endDate = row['end_date'];\n  if(actual_start_date.length > 0 && anticipatedStartDate.length > 0){\n    var start_date = moment(anticipatedStartDate);\n    var thisdate = moment(actual_start_date);\n    var diff = thisdate.diff(start_date,'days');\n    valid = diff>=0?true:'Actual start date should be higher than anticipated start sate';\n  }else if(endDate && endDate.length > 0 && anticipatedStartDate.length === 0) {\n    valid = 'Please select start date';\n  }\n}catch(e) {\n  console.log('Error from anticipated start date: events', e.message);\n}","required":false,"customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"key":"start_date","logic":[{"name":"actualStartDateChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"actualStartDateChangeAction","type":"customAction","customAction":"var object = result[1];\nif(object && object.changed.component.key==='start_date') {\n  var number_of_days = row['number_of_days'];\n  if(number_of_days) {\n    row['end_date'] = moment(value).add(parseInt(number_of_days),'days');\n  }else{\n   row['end_date'] = value; \n  }\n}"}]}],"type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"e43ia3e"},{"label":"Actual End Date","displayInTimezone":"submission","format":"yyyy-MM-dd","disabled":true,"tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"timePicker":{"showMeridian":false,"hourStep":1,"minuteStep":1,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"redrawOn":"data","validate":{"custom":"try{\n  var endDate = row['end_date'];\n  var startDate = row['start_date'];\n  if(startDate.length > 0 && endDate.length > 0){\n    var start_date = moment(startDate);\n    var thisdate = moment(endDate);\n    var diff = thisdate.diff(start_date,'days');\n    valid = diff>=0?true:'End date should be higher than start date';\n  }else  {\n    valid = true;\n  }\n}catch(e) {\n  console.log('Error from anticipated decision date: works', e.message);\n}","required":false,"customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"key":"end_date","customConditional":"show = Boolean(['PECP','Extension','Suspension'].includes(row['milestone_type_name']))","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"submission","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":true,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","timezone":"","datepickerMode":"day","customOptions":{},"id":"ev0hqgo"},{"label":"isComplete","hidden":true,"tableView":false,"defaultValue":false,"clearOnHide":false,"key":"is_complete","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"eaboyfq"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"OH Attendance","tableView":false,"key":"oh_attendance","customConditional":"var possible_values = ['Virtual Open House','Open House'];\nshow = Boolean(possible_values.includes(row['milestone_type_name']))","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"eza7l0j"},{"label":"Number of Days","tableView":true,"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"key":"number_of_days","customConditional":"show = Boolean(['PECP','Extension','Suspension'].includes(row['milestone_type_name']))","logic":[{"name":"numberOfDaysChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"numberOfDaysChangeAction","type":"customAction","customAction":"var object = result[1];\n\nif(object && object.changed.component.key==='number_of_days') {\n  var number_of_days = parseInt(value);\n  var date_ctrl = row.start_date?'end_date':'anticipated_end_date';\n  row[date_ctrl] = moment(row[date_ctrl==='end_date'?'start_date':'anticipated_start_date']).add(number_of_days,'days').format('YYYY-MM-DD');\n}"}]}],"type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"e9rzytl"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4}],"key":"columns","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"e6w9lw"}],"placeholder":"","prefix":"","suffix":"","multiple":false,"defaultValue":null,"unique":false,"refreshOn":"","dataGridLabel":false,"widget":null,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"defaultOpen":false,"id":"e1mwxys"}]},{"label":"Engagements","key":"engagementstab","components":[{"label":"Engagements","labelPosition":"top","labelWidth":"","labelMargin":"","description":"","tooltip":"","disableAddingRemovingRows":true,"conditionalAddButton":"","reorder":false,"addAnother":"","addAnotherPosition":"bottom","layoutFixed":false,"enableRowGroups":false,"initEmpty":false,"customClass":"","tabindex":"","hidden":false,"hideLabel":false,"autofocus":false,"disabled":false,"tableView":false,"modalEdit":false,"defaultValue":[{"title":"","start_date":"","end_date":"","phase_label":"","staff_id":""}],"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","clearOnHide":true,"customDefaultValue":"// console.log('DATA',value)\n// var engagementInterval = setInterval(function(instance){\n//   var engagements = data.engagements;\n//   if(engagements && engagements.length > 1) {\n//     clearInterval(engagementInterval);\n//     engagements.forEach(engagement=>engagement.work_engagements.enagement_id = engagement.id);\n//     debugger\n//     instance.setValue(value);\n//   }\n// },100);\n\n","calculateValue":"","calculateServer":false,"allowCalculateOverride":false,"validateOn":"change","validate":{"required":false,"minLength":"","maxLength":"","customMessage":"","custom":"","customPrivate":false,"json":"","strictDateValidation":false,"multiple":false,"unique":false},"errorLabel":"","errors":"","key":"engagements","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"","logic":[{"name":"pecpEventsUpdatedLogic","trigger":{"type":"event","event":"pecpEventUpdated"},"actions":[{"name":"pecpEventsUpdatedAction","type":"customAction","customAction":"debugger\r\nclass EngagementCalculator {\r\n    constructor() {\r\n        this.eventArgs = result[0];\r\n        this.dateFormat = 'YYYY-MM-DD';\r\n        this.phases = data['works-work_phases'];\r\n        this.events = data['works-events'];\r\n        this.engagements = data['engagements'];\r\n        this.phaseIndex = this.eventArgs.pecp ? this.eventArgs.pecp.phaseindex : this.eventArgs.pecpClose.phaseindex;\r\n        this.correlationKey = this.eventArgs.pecp ? this.eventArgs.pecp.correlationkey : this.eventArgs.pecpClose.correlationkey;\r\n        this.MILESTONE_TYPES = ['PECP', 'PECP Coming', 'PECP Open', 'PECP Closing'];\r\n        this.relatedPECP = ['insert', 'update'].includes(this.eventArgs.op) ? this.eventArgs.pecp : (this.events.filter(p => p.correlationkey === this.eventArgs.pecpClose.correlationkey)[0]);\r\n        this.instance = instance;\r\n        this.milestones = this.engagements.filter(p => p.phaseindex === this.phaseIndex\r\n            && this.MILESTONE_TYPES.includes(p.milestone_type_name)).map(p => {\r\n                return {\r\n                    milestone_type_name: p.milestone_type_name,\r\n                    milestone_id: p.work_engagements.milestone_id,\r\n                    title: p.title\r\n                }\r\n            });\r\n    }\r\n\r\n    process() {\r\n        const self = this;\r\n        if (self.eventArgs.op === 'delete') {\r\n            var deleteIndex = self.engagements.findIndex(p => p.correlationkey === self.correlationKey);\r\n            [1, 2, 3, 4].forEach(i => self.engagements.splice(deleteIndex, 1));\r\n            self.bindGrid();\r\n        } else {\r\n            if(!this.milestones || this.milestones.length < 4) {\r\n            self.getMilestones((self.phases[self.phaseIndex]).phase_id).then(result => {\r\n                self.milestones = result.data.filter(p => p.kind === 'ENGAGEMENT' && self.MILESTONE_TYPES.includes(p.milestone_type.name))\r\n                    .map(p => {\r\n                        return {\r\n                            milestone_type_name: p.milestone_type.name,\r\n                            milestone_id: p.id,\r\n                            title: p.name\r\n                        }\r\n                    })\r\n                result.self.engagementDateCalculation();\r\n            })\r\n        }else{\r\n            self.engagementDateCalculation();\r\n        }\r\n        }\r\n    }\r\n    getMilestones(phase_id) {\r\n        const self = this;\r\n        try {\r\n            var headers = {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + localStorage.getItem('authToken')\r\n                }\r\n            }\r\n            return new Promise((resolve, reject) => {\r\n                fetch(data.reportapiurl + 'milestones/phases/' + phase_id, headers)\r\n                    .then(response => response.json())\r\n                    .then(data => {\r\n                        resolve({ data, self });\r\n                    })\r\n                    .catch(err => reject(err))\r\n            });\r\n        } catch (e) {\r\n            console.log(e.message);\r\n        }\r\n    }\r\n    engagementDateCalculation() {\r\n        const self = this;\r\n        var pecpEngagementToUpdate;\r\n        var pecpEngagementToUpdateIndex = -1;\r\n        var phaseFilteredEngagements = self.engagements.filter(p => p.phaseindex === self.phaseIndex\r\n            && p.milestone_type_name === self.MILESTONE_TYPES[0]);\r\n\r\n        if (self.eventArgs.op === 'insert') {\r\n            // In case if first PECP added to a phase, the corresponding engagement will have correlationkey 'default'\r\n            // then we change it to the correlationkey of the newly added event PECP\r\n            pecpEngagementToUpdate = phaseFilteredEngagements.filter(p => p.correlationkey === 'default')[0];\r\n            if (pecpEngagementToUpdate) pecpEngagementToUpdate.correlationkey = self.relatedPECP.correlationkey;\r\n        }\r\n        pecpEngagementToUpdate = self.createPECPEngagement(self.MILESTONE_TYPES[0], 0, self.relatedPECP.number_of_days);\r\n        pecpEngagementToUpdateIndex = self.engagements.findIndex(p => p.correlationkey === pecpEngagementToUpdate.correlationkey\r\n            && p.milestone_type_name === self.MILESTONE_TYPES[0]);\r\n        var pecpComingEngagement = self.createPECPEngagement(self.MILESTONE_TYPES[1], -7, 0);\r\n        var pecpOpenEngagement = self.createPECPEngagement(self.MILESTONE_TYPES[2], 0, 0);\r\n        var pecpClosingEngagement = self.createPECPEngagement(self.MILESTONE_TYPES[3], self.relatedPECP.number_of_days - 2, 0);\r\n        var indexOffset = -1;\r\n        var deleteCount = 1;\r\n        if (pecpEngagementToUpdateIndex === -1) {\r\n            self.engagements.forEach((engagement, index) => {\r\n                if (engagement.phaseindex === self.phaseIndex && engagement.milestone_type_name === self.MILESTONE_TYPES[0]) {\r\n                    pecpEngagementToUpdateIndex = index;\r\n                }\r\n            });\r\n            if(pecpEngagementToUpdateIndex !== -1) {\r\n                indexOffset = 3;\r\n                deleteCount = 0;\r\n            }else {\r\n                pecpEngagementToUpdateIndex = 2;\r\n                deleteCount = 0;\r\n            }\r\n        }\r\n        [pecpComingEngagement, pecpEngagementToUpdate, pecpOpenEngagement, pecpClosingEngagement]\r\n            .forEach(pecp => {\r\n                self.engagements.splice(pecpEngagementToUpdateIndex + (indexOffset++), deleteCount, pecp)\r\n            });\r\n        self.bindGrid();\r\n    }\r\n    createPECPEngagement(milestoneType, dateOffset, duration, args) {\r\n        const self = this;\r\n        var newPECPStartDate = moment(self.relatedPECP.start_date != \"\" ? self.relatedPECP.start_date : self.relatedPECP.anticipated_start_date).add(dateOffset, 'days');\r\n        var milestone = self.milestones.filter(p => p.milestone_type_name === milestoneType)[0];\r\n        var currentPhase = self.phases[self.phaseIndex];\r\n        var pecpEng = {\r\n            phase_label: currentPhase.phasename,\r\n            title: milestoneType === self.MILESTONE_TYPES[0] ? self.relatedPECP.title : milestone.title,\r\n            start_date: moment(newPECPStartDate).format(self.dateFormat),\r\n            end_date: moment(newPECPStartDate).add(duration, 'days').format(self.dateFormat),\r\n            id: '',\r\n            phaseindex: self.phaseIndex,\r\n            duration,\r\n            correlationkey: self.relatedPECP.correlationkey,\r\n            milestone_type_name: milestoneType,\r\n            \"work_engagements\": {\r\n                phase_id: currentPhase.phase_id,\r\n                id: '',\r\n                project_id: submission.data.works.project_id,\r\n                work_type_id: submission.data.works.work_type_id,\r\n                engagement_id: '',\r\n                milestone_id: milestone.milestone_id\r\n            }\r\n        }\r\n        return pecpEng;\r\n    }\r\n    bindGrid() {\r\n        const self = this;\r\n        var engagementGrid = utils.getComponent(self.instance.parent.components, 'engagements');\r\n        engagementGrid.resetValue();       \r\n        setTimeout(function () {\r\n            engagementGrid.setValue(self.engagements);\r\n        }, 100);\r\n    }\r\n\r\n}\r\n\r\nvar obj = new EngagementCalculator();\r\nobj.process();\r\n"}]},{"name":"phaseDatesChangedLogic","trigger":{"type":"event","event":"phaseDatesChanged"},"actions":[{"name":"phaseDatesChangedAction","type":"customAction","customAction":"debugger\r\nvar engagements = data['engagements'];\r\nvar dateFormat = 'YYYY-MM-DD';\r\nvar phaseToBeAdjustedIndex = !result[0].isStartEvent?(result[0].phaseindex+1):result[0].phaseindex;\r\nvar numDaysBeAdjusted = result[0].datediff;\r\nif(!result[0].isStartEvent) {\r\n    var pPhaseEngs = engagements.filter(p=>p.phaseindex === result[0].phaseindex);\r\n    var pLastEng = pPhaseEngs[pPhaseEngs.length - 1];\r\n    pLastEng.start_date = moment(pLastEng.start_date).add(numDaysBeAdjusted, 'days').format(dateFormat);\r\n    pLastEng.end_date = moment(pLastEng.end_date).add(numDaysBeAdjusted, 'days').format(dateFormat);\r\n}\r\nengagements.forEach((engagement,index)=>{\r\n    if(engagement.phaseindex >= phaseToBeAdjustedIndex) {\r\n        engagement.start_date = moment(engagement.start_date).add((numDaysBeAdjusted),'days').format(dateFormat);\r\n        engagement.end_date = moment(engagement.end_date).add(numDaysBeAdjusted,'days').format(dateFormat);\r\n    }\r\n});\r\n\r\nvalue = engagements;\r\ninstance.setValue(engagements);"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"datagrid","input":true,"components":[{"label":"Phase","tag":"div","className":"form-control","attrs":[{"attr":"style","value":"background-color: #e9ecef"}],"content":"{{row.phase_label}}","refreshOnChange":false,"key":"html","type":"htmlelement","input":false,"tableView":false,"id":"e6sj40f0","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[]},{"label":"Title","tag":"div","className":"form-control","attrs":[{"attr":"style","value":"background-color: #e9ecef"}],"content":"{{row.title}}","refreshOnChange":true,"key":"html1","type":"htmlelement","input":false,"tableView":false,"id":"ehb9bqc0","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[]},{"label":"Start Date","format":"yyyy-MM-dd","disabled":true,"tableView":false,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"key":"start_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"id":"ewi4mia0","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"enableTime":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{}},{"label":"End Date","format":"yyyy-MM-dd","disabled":true,"tableView":false,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"key":"end_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"id":"e2lhkmv0","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"enableTime":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{}}],"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"refreshOn":"","dataGridLabel":false,"widget":null,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"id":"e99azds"}]},{"label":"Issues","key":"issue","components":[{"label":"IssuesGrid","hideLabel":true,"tableView":false,"rowDrafts":false,"key":"works-issues","type":"editgrid","displayAsTable":false,"input":true,"components":[{"label":"Title","tableView":true,"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"key":"title","type":"textfield","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"id":"e40xd6"},{"label":"id","key":"id","type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"e9tf2cs"},{"label":"Short Description","autoExpand":false,"tableView":false,"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"key":"short_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"rows":3,"wysiwyg":false,"editor":"","fixedSize":true,"id":"e2f82qj"},{"label":"Long Description","rows":6,"autoExpand":false,"tableView":false,"key":"long_description","type":"textarea","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":"","minWords":"","maxWords":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"html","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false,"wysiwyg":false,"editor":"","fixedSize":true,"id":"ervb6d"},{"label":"Columns","columns":[{"components":[{"label":"Start Date","format":"yyyy-MM-dd","tableView":true,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"timePicker":{"showMeridian":false,"hourStep":1,"minuteStep":1,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"key":"start_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":true,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","customOptions":{},"id":"eebwzf"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4},{"components":[{"label":"Anticipated Resolution Date","format":"yyyy-MM-dd","tableView":false,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"key":"anticipated_resolution_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"exbfvvp"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4},{"components":[{"label":"Resolution Date","format":"yyyy-MM-dd","tableView":false,"enableMinDateInput":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false,"showWeeks":true,"startingDay":0,"initDate":"","minMode":"day","maxMode":"year","yearRows":4,"yearColumns":5,"minDate":null,"maxDate":null},"enableMaxDateInput":false,"enableTime":false,"key":"resolution_date","type":"datetime","input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":false,"noCalendar":false,"format":"yyyy-MM-dd","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null},"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":"","protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"useLocaleSettings":false,"allowInput":true,"enableDate":true,"defaultDate":"","displayInTimezone":"viewer","timezone":"","datepickerMode":"day","timePicker":{"hourStep":1,"minuteStep":1,"showMeridian":true,"readonlyInput":false,"mousewheel":true,"arrowkeys":true},"customOptions":{},"id":"exudmdg"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4}],"key":"columns","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"ejgcla"},{"label":"Columns","columns":[{"components":[{"label":"Key Issue","tableView":true,"defaultValue":false,"key":"is_key_issue","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"e11sbp7"}],"width":3,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":3},{"components":[{"label":"Sensitive","labelWidth":30,"tableView":false,"defaultValue":false,"key":"is_sensitive","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"e86cv2q"}],"width":3,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":3},{"components":[{"label":"Active","tableView":true,"defaultValue":false,"key":"is_active","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"eutdhq"}],"size":"md","width":3,"offset":0,"push":0,"pull":0,"currentWidth":3},{"components":[{"label":"Resolved","tableView":true,"defaultValue":false,"key":"is_resolved","type":"checkbox","input":true,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":true,"labelPosition":"right","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"checkbox","value":"","name":"","id":"e1iw8bl"}],"size":"md","width":3,"offset":0,"push":0,"pull":0,"currentWidth":3}],"key":"columns1","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"eourxhd"}],"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"disableAddingRemovingRows":false,"removeRow":"Cancel","defaultOpen":false,"openWhenEmpty":false,"modal":false,"inlineEdit":false,"templates":{"header":"<div class=\"row\">\n      {% util.eachComponent(components, function(component) { %}\n        {% if (displayValue(component)) { %}\n          <div class=\"col-sm-2\">{{ t(component.label) }}</div>\n        {% } %}\n      {% }) %}\n    </div>","row":"<div class=\"row\">\n      {% util.eachComponent(components, function(component) { %}\n        {% if (displayValue(component)) { %}\n          <div class=\"col-sm-2\">\n            {{ isVisibleInRow(component) ? getView(component, row[component.key]) : ''}}\n          </div>\n        {% } %}\n      {% }) %}\n      {% if (!instance.options.readOnly && !instance.disabled) { %}\n        <div class=\"col-sm-2\">\n          <div class=\"btn-group pull-right\">\n            <button class=\"btn btn-default btn-light btn-sm editRow\"><i class=\"{{ iconClass('edit') }}\"></i></button>\n            {% if (!instance.hasRemoveButtons || instance.hasRemoveButtons()) { %}\n              <button class=\"btn btn-danger btn-sm removeRow\"><i class=\"{{ iconClass('trash') }}\"></i></button>\n            {% } %}\n          </div>\n        </div>\n      {% } %}\n    </div>","tableHeader":"\n      <tr>\n        {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">{{ component.label }}</td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">Actions</td>\n        {% } %}\n      </tr>\n    ","tableRow":"\n      {% util.eachComponent(components, function(component) { %}\n          {% if (!component.hasOwnProperty('tableView') || component.tableView) { %}\n            <td class=\"editgrid-table-column\">\n              {{ getView(component, row[component.key]) }}\n            </td>\n          {% } %}\n        {% }) %}\n        {% if (!instance.options.readOnly && !instance.disabled) { %}\n          <td class=\"editgrid-table-column\">\n            <div class=\"btn-group\">\n              <button class=\"btn btn-default btn-light btn-sm editRow\" aria-label=\"{{ t('Edit row') }}\"><i class=\"{{ iconClass('edit') }}\"></i></button>\n              {% if (!instance.hasRemoveButtons || instance.hasRemoveButtons()) { %}\n              <button class=\"btn btn-danger btn-sm removeRow\" aria-label=\"{{ t('Remove row') }}\"><i class=\"{{ iconClass('trash') }}\"></i></button>\n              {% } %}\n            </div>\n          </td>\n        {% } %}\n    ","footer":""},"id":"ef2xvm"}]},{"label":"Team","key":"team","components":[{"label":"Columns","columns":[{"components":[{"label":"EAO Team","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}codes/eao_teams","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"works.eao_team_id","type":"select","selectValues":"codes","input":true,"disableLimit":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"ey70k5f"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Responsible EPD","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}staffs/positions/3","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"works.responsible_epd_id","type":"select","selectValues":"staffs","input":true,"disableLimit":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"e2de3j4"}],"width":4,"offset":0,"push":0,"pull":0,"size":"md","currentWidth":4},{"components":[{"label":"Work Lead","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}staffs/positions/4","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"works.work_lead_id","type":"select","selectValues":"staffs","input":true,"disableLimit":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false,"id":"esh81zh"}],"size":"md","width":4,"offset":0,"push":0,"pull":0,"currentWidth":4}],"key":"columns2","type":"columns","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"autoAdjust":false,"id":"em7cin"},{"html":"<p>Team members for this work</p>","label":"Content","refreshOnChange":false,"key":"content","type":"content","input":false,"tableView":false,"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"id":"ecvgvml"},{"label":"Teams","reorder":false,"addAnotherPosition":"bottom","layoutFixed":false,"enableRowGroups":false,"initEmpty":true,"hideLabel":true,"tableView":false,"defaultValue":[{"staff_id":"","role_id":"","position":"","phone":"","email":"","id":""}],"calculateValue":"try{\r\n  for(var index = 0;index<submission.data['works-staff_work_roles'].length;index++) {\r\n    var result = instance.flattenComponents(index);\r\n    var staffs = data.onload.staffs;\r\n    if(staffs && staffs.length > 0) {\r\n      var staff = staffs.filter(p=>p.id==(data['works-staff_work_roles'][index]).staff_id)[0];\r\n\t\t  var position = result['position'];\r\n\t\t  var phone = result['phone'];\r\n\t      var email = result['email'];\r\n\t      position.setValue(staff?staff.position.name:'');\r\n\t      phone.setValue(staff?staff.phone:'');\r\n\t      email.setValue(staff?staff.email:'');\r\n    }\r\n  }\r\n}catch(e){\r\n  console.error(e.message);\r\n}","key":"works-staff_work_roles","type":"datagrid","input":true,"components":[{"label":"Team Member","widget":"choicesjs","tableView":true,"dataSrc":"custom","data":{"custom":"values = data.onload.staffs;","values":[{"label":"","value":""}],"json":"","url":"","resource":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"staff_id","type":"select","input":true,"id":"ee6uufh000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false},{"label":"Role","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}codes/roles","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"role_id","type":"select","selectValues":"codes","input":true,"disableLimit":false,"id":"eadxu4i000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false},{"label":"Position","disabled":true,"tableView":true,"key":"position","type":"textfield","input":true,"id":"eyav1xe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false},{"label":"Phone","disabled":true,"tableView":true,"key":"phone","type":"textfield","input":true,"id":"ezf2q2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false},{"label":"Email","disabled":true,"tableView":true,"key":"email","type":"textfield","input":true,"id":"egcf42000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"minLength":"","maxLength":"","pattern":""},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"mask":false,"inputType":"text","inputFormat":"plain","inputMask":"","displayMask":"","spellcheck":true,"truncateMultipleSpaces":false},{"label":"id","key":"id","type":"hidden","input":true,"tableView":false,"id":"eau9y8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden"}],"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"disableAddingRemovingRows":false,"id":"ebfqcbt"}]},{"label":"PINs","key":"pin","components":[{"label":"PINGrid","reorder":false,"addAnotherPosition":"bottom","layoutFixed":false,"enableRowGroups":false,"initEmpty":true,"tableView":false,"defaultValue":[{"indigenous_nation_id":"","indigenous_category_id":"","id":""}],"key":"works-indigenous_works","type":"datagrid","input":true,"components":[{"label":"Indigenous Nation","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}codes/indigenous_nations","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"indigenous_nation_id","type":"select","selectValues":"codes","input":true,"disableLimit":false,"id":"e11sb6r000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false},{"label":"Indigenous Category","widget":"choicesjs","tableView":true,"dataSrc":"url","data":{"url":"{{data.reportapiurl}}codes/indigenous_categories","headers":[{"key":"Authorization","value":"Bearer {{localStorage.getItem('authToken')}}"}],"values":[{"label":"","value":""}],"json":"","resource":"","custom":""},"valueProperty":"id","template":"<span>{{ item.name }}</span>","validate":{"required":true,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false,"onlyAvailableItems":false},"key":"indigenous_category_id","type":"select","selectValues":"codes","input":true,"disableLimit":false,"id":"en8dm15000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"attributes":{},"validateOn":"change","conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"idPath":"id","clearOnRefresh":false,"limit":100,"lazyLoad":true,"filter":"","searchEnabled":true,"searchDebounce":0.3,"searchField":"","minSearch":0,"readOnlyValue":false,"authenticate":false,"ignoreCache":false,"selectFields":"","selectThreshold":0.3,"uniqueOptions":false,"fuseOptions":{"include":"score","threshold":0.3},"indexeddb":{"filter":{}},"customOptions":{},"useExactSearch":false},{"label":"id","key":"id","type":"hidden","input":true,"tableView":false,"id":"eurgucd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"inputType":"hidden"}],"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"protected":false,"unique":false,"persistent":true,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":true,"lazyLoad":false,"disableAddingRemovingRows":false,"id":"et93myp"}]}],"customClass":"table table-border","key":"tabs1","type":"tabs","input":false,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"verticalLayout":false,"id":"ep074g9"}],"placeholder":"","prefix":"","customClass":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"hidden":false,"clearOnHide":false,"refreshOn":"","redrawOn":"","modalEdit":false,"dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":null,"attributes":{},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"overlay":{"style":"","left":"","top":"","width":"","height":""},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"properties":{},"allowMultipleMasks":false,"addons":[],"tree":false,"lazyLoad":false,"theme":"default","breadcrumb":"default","id":"e3y0qqw"},{"label":"Submit","labelWidth":"","labelMargin":"","action":"custom","showValidations":true,"theme":"primary","size":"md","block":false,"leftIcon":"fa fa-save","rightIcon":"","shortcut":"","description":"","tooltip":"","customClass":"","tabindex":"","disableOnInvalid":false,"hidden":false,"autofocus":false,"disabled":false,"tableView":false,"modalEdit":false,"key":"alternatesubmit","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"show = Boolean(data.applicationId)","logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"button","custom":"form.emit('submitButton', {\r\n          state: instance.component.state || 'submitted',\r\n          component: instance.component,\r\n          instance: instance\r\n        });\r\n// if(form.isValid()) {\r\n// const submissionId = form._submission._id;\r\n// const formDataReqUrl = form.formio.formUrl+'/submission/'+submissionId;\r\n// const formDataReqObj1 =  {  \"_id\": submissionId,  \"data\": data};\r\n// const formio = new Formio(formDataReqUrl);\r\n// formio.saveSubmission(formDataReqObj1).then( result => {\r\n  \r\n// form.emit('customEvent', {\r\n//           type: \"actionComplete\",   \r\n//           component: component,\r\n//           actionType:data.actionType\r\n//     }); \r\n// window.reload();\r\n// }).catch((error)=>{\r\n// //Error callback on not Save\r\n\r\n// });\r\n// }\r\n","input":true,"placeholder":"","prefix":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","dataGridLabel":true,"labelPosition":"top","errorLabel":"","hideLabel":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"id":"eslir"},{"label":"Submit","labelWidth":"","labelMargin":"","action":"submit","showValidations":false,"theme":"primary","size":"md","block":false,"leftIcon":"fa fa-save","rightIcon":"","shortcut":"","description":"","tooltip":"","customClass":"","tabindex":"","disableOnInvalid":false,"hidden":false,"autofocus":false,"disabled":false,"tableView":false,"modalEdit":false,"key":"submit","tags":[],"properties":{},"conditional":{"show":null,"when":null,"eq":"","json":""},"customConditional":"show = !Boolean(data.applicationId)","logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"button","input":true,"saveOnEnter":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"defaultValue":null,"protected":false,"unique":false,"persistent":false,"clearOnHide":true,"refreshOn":"","redrawOn":"","dataGridLabel":true,"labelPosition":"top","errorLabel":"","hideLabel":false,"dbIndex":false,"customDefaultValue":"","calculateValue":"","calculateServer":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"allowCalculateOverride":false,"encrypted":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"id":"ez4cf7r"},{"label":"applicationId","customClass":"","modalEdit":false,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"","calculateValue":"","calculateServer":false,"key":"applicationId","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","tableView":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"inputType":"hidden","id":"em1y8gd","defaultValue":"","dataGridLabel":false,"addons":[]},{"label":"applicationStatus","customClass":"","modalEdit":false,"defaultValue":null,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"","calculateValue":"","calculateServer":false,"key":"applicationStatus","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"inputType":"hidden","id":"e6z1qd9","addons":[]},{"label":"actionType ","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":"0","persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"","calculateValue":"value = parseInt(value);","calculateServer":false,"key":"actionType","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"ehty36b"},{"label":"isWorkTerminated","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":null,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"value = false;","calculateValue":"","calculateServer":false,"key":"isworkterminated","tags":[],"properties":{},"logic":[{"name":"isWorkTerminatedFlagChangeLogic","trigger":{"type":"event","event":"change"},"actions":[{"name":"isWorkTerminatedFlagChangeAction","type":"customAction","customAction":"var events = submission.data['works-events'];\nvar outcomes = data.onload.outcomes;\nfor(var i = 0;i < events.length; i++) {\n  var event = events[i];\n        if (event.decision_id !== \"\" && event.is_active === true) {\n            var outcome = outcomes.filter(p => p.id === parseInt(event.decision_id));\n            if (outcome.length > 0 && outcome[0].terminates_work === true){\n                    data.isworkterminated = true;\n                    break;\n            }else{\n              data.isworkterminated = false;\n            } \n            }else{\n          data.isworkterminated = false;\n        }\n        \n}"}]}],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"epyucqa"},{"label":"activePhase","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":"0","persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"","calculateValue":"value = parseInt(value);","calculateServer":false,"key":"activephase","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"ef7c4wl"},{"label":"completedEvent","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":null,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"value=\"\"","calculateValue":"","calculateServer":false,"key":"completedEvent","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"eg76d0i"},{"label":"completedEventPhase","labelWidth":"","labelMargin":"","customClass":"","modalEdit":false,"defaultValue":null,"persistent":true,"protected":false,"dbIndex":false,"encrypted":false,"redrawOn":"","customDefaultValue":"value=\"\"","calculateValue":"","calculateServer":false,"key":"completedEventPhase","tags":[],"properties":{},"logic":[],"attributes":{},"overlay":{"style":"","page":"","left":"","top":"","width":"","height":""},"type":"hidden","input":true,"tableView":false,"placeholder":"","prefix":"","suffix":"","multiple":false,"unique":false,"hidden":false,"clearOnHide":true,"refreshOn":"","dataGridLabel":false,"labelPosition":"top","description":"","errorLabel":"","tooltip":"","hideLabel":false,"tabindex":"","disabled":false,"autofocus":false,"widget":{"type":"input"},"validateOn":"change","validate":{"required":false,"custom":"","customPrivate":false,"strictDateValidation":false,"multiple":false,"unique":false},"conditional":{"show":null,"when":null,"eq":""},"allowCalculateOverride":false,"showCharCount":false,"showWordCount":false,"allowMultipleMasks":false,"addons":[],"inputType":"hidden","id":"eyzfmhi"}]}]}