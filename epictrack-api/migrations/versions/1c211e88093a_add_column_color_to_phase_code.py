"""add column color to phase_code

Revision ID: 1c211e88093a
Revises: af1a598657ad
Create Date: 2022-03-21 22:21:22.545266

"""
from alembic import op
import sqlalchemy as sa
import json


# revision identifiers, used by Alembic.
revision = '1c211e88093a'
down_revision = 'af1a598657ad'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    phase_code = op.add_column('phase_codes', sa.Column('color', sa.String(length=15), nullable=True))
    phases = [{
            'sort_order': 1,
            'name': 'Early Engagement',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#E1EBF3'
        },
        {
            'sort_order': 2,
            'name': 'Proponent Time: Project Description',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#CCFFFF'
        },
        {
            'sort_order': 3,
            'name': 'Readiness Decision',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#C3D7E8'
        }, {
            'sort_order': 4,
            'name': 'Process Planning',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#A6C3DD'
        }, {
            'sort_order': 5,
            'name': 'Proponent Time: Application Development',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#CCFFFF'
        }, {
            'sort_order': 6,
            'name': 'Application Development & Review',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#FAEADC'
        }, {
            'sort_order': 7,
            'name': 'Proponent Time: Revised Application',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#CCFFFF'
        }, {
            'sort_order': 8,
            'name': 'Effects Assessment',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#F6D5B9'
        }, {
            'sort_order': 9,
            'name': 'Recommendation',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#F2C096'
        }, {
            'sort_order': 10,
            'name': 'Referral/Decision',
            'work_type_id': 6,
            'ea_act_id': 3,
            'color': '#F2C096'
        }]

    op.execute(
        """
        UPDATE phase_codes set color = phase.color FROM (
            SELECT  * FROM json_populate_recordset(null::phase_codes,'%s')
        ) phase
        WHERE phase_codes.name = phase.name AND phase_codes.work_type_id = phase.work_type_id AND phase_codes.ea_act_id = phase.ea_act_id
        """ % json.dumps(phases)
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('phase_codes', 'color')
    # ### end Alembic commands ###
