"""more_indigenous_categories

Revision ID: 45123f9bd196
Revises: 39088a8b3a63
Create Date: 2023-05-17 12:43:19.715123

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.sql import column, table, text


# revision identifiers, used by Alembic.
revision = '45123f9bd196'
down_revision = '39088a8b3a63'
branch_labels = None
depends_on = None

indigenous_categories = table(
    "indigenous_categories",
    column("id", sa.Integer),
    column("name", sa.String),
    column("sort_order", sa.Integer),
    column("is_active", sa.Boolean)
)
data = [
    {
        "name": "PIN",
        "sort_order": 1,
        "is_active": True
    },
    {
        "name": "TAC Member",
        "sort_order": 2,
        "is_active": True
    },
        {
        "name": "Notification",
        "sort_order": 3,
        "is_active": True
    },
        {
        "name": "Working Group",
        "sort_order": 4,
        "is_active": True
    },
        {
        "name": "Collaboration",
        "sort_order": 5,
        "is_active": True
    },
        {
        "name": "Consultation Agreement",
        "sort_order": 6,
        "is_active": True
    },
        {
        "name": "Consent Required",
        "sort_order": 7,
        "is_active": True
    }
    ]

def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    conn = op.get_bind()
    for in_cat in data:
        query = text(f"SELECT id FROM indigenous_categories WHERE name='{in_cat['name']}'")
        result = conn.execute(query).fetchone()
        if result is None:
            result = conn.execute(
                indigenous_categories.insert().values(**in_cat)
            )
        else:
            conn.execute(
                indigenous_categories.update()
                    .where(indigenous_categories.c.name == in_cat['name'])
                    .values(**in_cat)
            )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###
